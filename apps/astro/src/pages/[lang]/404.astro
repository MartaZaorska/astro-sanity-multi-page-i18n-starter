---
import type { Language } from '@/global/languages';
import sanityFetch from '@/utils/sanity.fetch';
import pageFetch from '@/utils/page.fetch';
import DefaultPage from '@/templates/default.astro';

export async function getStaticPaths(){
  const languages = await sanityFetch<string[]>({
    query: `*[_type == "NotFound_Page" && defined(slug.current)].language`,
  });

  return languages?.map(lang => ({ params: { lang }}));
}

const { lang } = Astro.params as { lang: Language };
const data = await pageFetch({ slug: `/${lang}/404`, lang });

if(!data) return Astro.rewrite('/404');
---
<DefaultPage {...data} />
